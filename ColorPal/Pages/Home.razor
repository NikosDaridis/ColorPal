@inherits PageBase

@page "/"

@if (!_isInitialized)
    return;

<SelectedColor NavigationManager=NavigationManager JSRuntime=JSRuntime LocalStorageService=LocalStorageService EventAggregator=EventAggregator StateService=StateService />
<div class="px-3 py-2">
    <ColorCodeTabs LocalStorageService=LocalStorageService EventAggregator=EventAggregator />
    <ColorCodePanel JSRuntime=JSRuntime LocalStorageService=LocalStorageService EventAggregator=EventAggregator />
</div>

<div class="grid gap-3 bg-[var(--secondary-color)] px-3 pt-1 pb-2">
    <ColorsToolBar JSRuntime=JSRuntime LocalStorageService=LocalStorageService EventAggregator=EventAggregator StateService=StateService />
    <ColorsGrid JSRuntime=JSRuntime LocalStorageService=LocalStorageService EventAggregator=EventAggregator />
</div>

@code {
    private bool _isInitialized;

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        if (LocalStorageService is null)
            return;

        try
        {
            await LocalStorageService.SetThemeAsync(await LocalStorageService.GetKeyAsync<string>(StorageKey.Theme) ?? Theme.Light.Value(), false);
        }
        catch
        {
            await LocalStorageService.SetThemeAsync(Theme.Light, false);
        }

        await LocalStorageService.ValidateAsync();

        _isInitialized = true;
        StateHasChanged();
    }
}
